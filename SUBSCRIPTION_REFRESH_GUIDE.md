# ุฑุงูููุง ุณุณุชู ุจุฑูุฒุฑุณุงู ููฺฉ Subscription

## ๐ ุฎูุงุตู

ุณุณุชู ุจุฑูุฒุฑุณุงู ููฺฉ subscription ุจู ฺฉุงุฑุจุฑุงู ู ุงุฏููโูุง ุงูฺฉุงู ุจุฑูุฒุฑุณุงู ููฺฉโูุง subscription ุฑุง ุงุฒ ูพูู ุงุตู X-UI ูโุฏูุฏ. ุงู ุณุณุชู ุชุถูู ูโฺฉูุฏ ฺฉู ููฺฉโูุง ููุดู ุขุฎุฑู ุชูุธูุงุช ูพูู ุฑุง ุฏุงุดุชู ุจุงุดูุฏ.

## ๐ง ูฺฺฏโูุง

### ุจุฑุง ฺฉุงุฑุจุฑุงู:
- **ุจุฑูุฒุฑุณุงู ููฺฉ ุดุฎุต**: ูุฑ ฺฉุงุฑุจุฑ ูโุชูุงูุฏ ููฺฉ subscription ุฎูุฏ ุฑุง ุจุฑูุฒุฑุณุงู ฺฉูุฏ
- **ููุงุด ูุถุนุช**: ููุงุด ูพุงูโูุง ููููุช ุง ุฎุทุง
- **ุฏุณุชุฑุณ ุขุณุงู**: ุงุฒ ุทุฑู ููู "ุณุฑูุณโูุง ูู"

### ุจุฑุง ุงุฏููโูุง:
- **ุจุฑูุฒุฑุณุงู ููู ููฺฉโูุง**: ุจุฑูุฒุฑุณุงู ฺฉุฌุง ููู ููฺฉโูุง ูุนุงู
- **ููุงุด ุขูุงุฑ**: ููุงุด ุชุนุฏุงุฏ ููฺฉโูุง ูููู ู ูุงูููู
- **ฺฉูุชุฑู ฺฉุงูู**: ุงุฒ ุทุฑู ููู ุงุฏูู

## ๐ ูุญูู ุงุณุชูุงุฏู

### ุจุฑุง ฺฉุงุฑุจุฑุงู:

1. **ูุฑูุฏ ุจู ููู ุณุฑูุณโูุง**:
   ```
   ููู ุงุตู โ ุณุฑูุณโูุง ูู
   ```

2. **ุงูุชุฎุงุจ ุณุฑูุณ**:
   ```
   ฺฉูฺฉ ุฑู ุณุฑูุณ ููุฑุฏ ูุธุฑ
   ```

3. **ุจุฑูุฒุฑุณุงู ููฺฉ**:
   ```
   ฺฉูฺฉ ุฑู "๐ ุจุฑูุฒุฑุณุงู ููฺฉ"
   ```

4. **ุงูุชุธุงุฑ ุจุฑุง ูุชุฌู**:
   ```
   ุณุณุชู ูพุงู ููููุช ุง ุฎุทุง ููุงุด ูโุฏูุฏ
   ```

### ุจุฑุง ุงุฏููโูุง:

1. **ูุฑูุฏ ุจู ููู ุงุฏูู**:
   ```
   ููู ุงุตู โ ููู ุงุฏูู
   ```

2. **ุงูุชุฎุงุจ ุจุฑูุฒุฑุณุงู**:
   ```
   ฺฉูฺฉ ุฑู "๐ ุจุฑูุฒุฑุณุงู ููู ููฺฉโูุง"
   ```

3. **ุงูุชุธุงุฑ ุจุฑุง ูุชุฌู**:
   ```
   ุณุณุชู ุขูุงุฑ ฺฉุงูู ููุงุด ูโุฏูุฏ
   ```

## ๐ API Endpoints

### ุจุฑูุฒุฑุณุงู ฺฉุงููฺฏโูุง:
```
POST /admin/update_configs/{purchase_id}
```

**Headers:**
```
Authorization: Bearer {ADMIN_API_KEY}
```

**Response:**
- `200`: ุจุฑูุฒุฑุณุงู ูููู
- `401`: ุฎุทุง ุงุญุฑุงุฒ ููุช
- `404`: ุฎุฑุฏ ุงูุช ูุดุฏ
- `500`: ุฎุทุง ุณุฑูุฑ

### ุฏุฑุงูุช ููฺฉ Subscription:
```
GET /sub/{sub_id}
```

**Response:**
- `200`: ููฺฉ subscription (Base64 encoded)
- `404`: ููฺฉ ุงูุช ูุดุฏ ุง ุบุฑูุนุงู

## โ๏ธ ุชูุธูุงุช

### ูุชุบุฑูุง ูุญุท:

```bash
# ุฏุงููู webhook
WEBHOOK_DOMAIN=your-domain.com

# ฺฉูุฏ API ุงุฏูู
ADMIN_API_KEY=your-secret-key
```

### ุชูุธูุงุช ุฏุชุงุจุณ:

```sql
-- ุฌุฏูู purchases ุจุงุฏ ููุฏูุง ุฒุฑ ุฑุง ุฏุงุดุชู ุจุงุดุฏ:
-- sub_id: ุดูุงุณู ฺฉุชุง ุจุฑุง subscription
-- single_configs_json: ฺฉุงููฺฏโูุง ุฐุฎุฑู ุดุฏู
-- updated_at: ุฒูุงู ุขุฎุฑู ุจุฑูุฒุฑุณุงู
```

## ๐ ูุฑุขูุฏ ุจุฑูุฒุฑุณุงู

1. **ุฏุฑุฎูุงุณุช ุจุฑูุฒุฑุณุงู**: ฺฉุงุฑุจุฑ ุง ุงุฏูู ุฏุฑุฎูุงุณุช ุจุฑูุฒุฑุณุงู ูโุฏูุฏ

2. **ุงุฑุชุจุงุท ุจุง ูพูู**: ุณุณุชู ุจู ูพูู X-UI ูุชุตู ูโุดูุฏ

3. **ุฏุฑุงูุช ุฏุชุง**: ฺฉุงููฺฏโูุง ุฌุฏุฏ ุงุฒ ูพูู ุฏุฑุงูุช ูโุดูุฏ

4. **ูพุฑุฏุงุฒุด ูุญุชูุง**: ูุญุชูุง ุชุดุฎุต ู ูพุฑุฏุงุฒุด ูโุดูุฏ (Base64, JSON, V2Ray)

5. **ุฐุฎุฑู ุฏุฑ ุฏุชุงุจุณ**: ฺฉุงููฺฏโูุง ุฌุฏุฏ ุฏุฑ ุฏุชุงุจุณ ุฐุฎุฑู ูโุดูุฏ

6. **ุจุงุฒฺฏุดุช ูุชุฌู**: ูพุงู ููููุช ุง ุฎุทุง ุจู ฺฉุงุฑุจุฑ ููุงุด ุฏุงุฏู ูโุดูุฏ

## ๐ก๏ธ ุงููุช

- **ุงุญุฑุงุฒ ููุช**: ููู ุฏุฑุฎูุงุณุชโูุง ุงุฏูู ูุงุฒ ุจู API key ุฏุงุฑูุฏ
- **ุงุนุชุจุงุฑุณูุฌ**: ุจุฑุฑุณ ูุฌูุฏ ุฎุฑุฏ ู ุณุฑูุฑ ูุจู ุงุฒ ุจุฑูุฒุฑุณุงู
- **ูุฏุฑุช ุฎุทุง**: ูุฏุฑุช ฺฉุงูู ุฎุทุงูุง ู ููุงุด ูพุงูโูุง ููุงุณุจ

## ๐ ูุงูุชูุฑูฺฏ

### ูุงฺฏโูุง ููู:
```
- ุจุฑูุฒุฑุณุงู ูููู: "Successfully updated cached configs for purchase {id}"
- ุฎุทุง ูพูู: "Error fetching subscription data from panel"
- ุฎุทุง ุฏุชุงุจุณ: "Error updating purchase configs for {id}"
```

### ุขูุงุฑ ูุงุจู ุฑุฏุงุจ:
- ุชุนุฏุงุฏ ุจุฑูุฒุฑุณุงูโูุง ูููู
- ุชุนุฏุงุฏ ุจุฑูุฒุฑุณุงูโูุง ูุงูููู
- ุฒูุงู ูุชูุณุท ุจุฑูุฒุฑุณุงู
- ุฎุทุงูุง ุฑุงุฌ

## ๐ง ุนุจโุงุจ

### ูุดฺฉูุงุช ุฑุงุฌ:

1. **ุฎุทุง 401 (Unauthorized)**:
   - ุจุฑุฑุณ ุตุญุช ADMIN_API_KEY
   - ุงุทููุงู ุงุฒ ูุฌูุฏ header Authorization

2. **ุฎุทุง 404 (Not Found)**:
   - ุจุฑุฑุณ ูุฌูุฏ purchase_id ุฏุฑ ุฏุชุงุจุณ
   - ุจุฑุฑุณ ูุนุงู ุจูุฏู subscription

3. **ุฎุทุง 500 (Server Error)**:
   - ุจุฑุฑุณ ุงุชุตุงู ุจู ูพูู X-UI
   - ุจุฑุฑุณ ุชูุธูุงุช ุณุฑูุฑ

### ุชุณุช ุณุณุชู:

```bash
# ุงุฌุฑุง ุชุณุชโูุง
python test_subscription_refresh.py

# ุจุฑุฑุณ ูุงฺฏโูุง
tail -f /var/log/alamorvpn_bot.log
```

## ๐ ูฺฉุงุช ููู

1. **ุนููฺฉุฑุฏ**: ุณุณุชู ุงุจุชุฏุง ุงุฒ ูพูู ุงุตู ุฏุชุง ุฏุฑุงูุช ูโฺฉูุฏุ ุฏุฑ ุตูุฑุช ุฎุทุง ุงุฒ ฺฉุด ุงุณุชูุงุฏู ูโฺฉูุฏ

2. **ุณุฑุนุช**: ุจุฑูุฒุฑุณุงู ูุนูููุงู 5-10 ุซุงูู ุทูู ูโฺฉุดุฏ

3. **ูุญุฏูุฏุช**: ูุฑ ฺฉุงุฑุจุฑ ููุท ูโุชูุงูุฏ ููฺฉโูุง ุฎูุฏ ุฑุง ุจุฑูุฒุฑุณุงู ฺฉูุฏ

4. **ูพุดุชุจุงู**: ุณุณุชู ุงุฒ ููู ููุน ูุญุชูุง subscription ูพุดุชุจุงู ูโฺฉูุฏ

5. **ููุงุณโูพุฐุฑ**: ุงูฺฉุงู ุจุฑูุฒุฑุณุงู ููุฒูุงู ฺูุฏู ููฺฉ ูุฌูุฏ ุฏุงุฑุฏ

## ๐ฏ ูุฒุงุง

- **ุจูโุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ**: ููฺฉโูุง ููุดู ุขุฎุฑู ุชูุธูุงุช ุฑุง ุฏุงุฑูุฏ
- **ูุงุจูุช ุงุทููุงู**: ุณุณุชู fallback ุจุฑุง ููุงูุน ุฎุทุง
- **ฺฉุงุฑุจุฑูพุณูุฏ**: ุฑุงุจุท ฺฉุงุฑุจุฑ ุณุงุฏู ู ูุงุจู ููู
- **ุงูู**: ุงุญุฑุงุฒ ููุช ู ุงุนุชุจุงุฑุณูุฌ ฺฉุงูู
- **ููุงุณโูพุฐุฑ**: ูพุดุชุจุงู ุงุฒ ุชุนุฏุงุฏ ุฒุงุฏ ููฺฉ
