# ๐ง ุฑุงูููุง ุฑูุน ูุดฺฉู Webhook Server

## ๐จ **ูุดฺฉู ูุนู:**
ุฎุทุงูุง HTTP 500 ุฏุฑ endpoint `/admin/update_configs/<purchase_id>`

## ๐ **ูุฑุงุญู ุนุจโุงุจ:**

### 1. **ุจุฑุฑุณ ุชูุธูุงุช ูุญุท**
```bash
# ุจุฑุฑุณ ูุชุบุฑูุง ูุญุท
echo $WEBHOOK_DOMAIN
echo $ADMIN_API_KEY
```

### 2. **ุชุณุช endpoint ูุง webhook**
```bash
# ุชุณุช endpoint ุงุทูุงุนุงุช purchase
curl -X GET "https://YOUR_DOMAIN/admin/test/1"

# ุชุณุช endpoint ุจุฑูุฒุฑุณุงู configs
curl -X POST "https://YOUR_DOMAIN/admin/update_configs/1" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### 3. **ุจุฑุฑุณ ูุงฺฏโูุง webhook server**
```bash
# ุจุฑุฑุณ ูุงฺฏโูุง webhook server
tail -f /var/log/webhook_server.log
```

## ๐๏ธ **ุฑุงูโุญูโูุง ูพุงุฏูโุณุงุฒ ุดุฏู:**

### โ **1. ุจูุจูุฏ Error Handling**
- ุงุถุงูู ุดุฏู logging ุฏููโุชุฑ
- ุจุฑุฑุณ ูุฌูุฏ sub_id ู server_id
- ุจุฑุฑุณ ูุถุนุช active ุจูุฏู purchase
- Fallback mechanism ุจุฑุง profile purchases

### โ **2. Endpoint ุชุณุช ุฌุฏุฏ**
- `/admin/test/<purchase_id>` ุจุฑุง ุจุฑุฑุณ ูุถุนุช purchase
- ููุงุด ุงุทูุงุนุงุช ฺฉุงูู purchase ุจุฏูู ูุงุฒ ุจู API key

### โ **3. ุจูุจูุฏ Validation**
- ุจุฑุฑุณ ADMIN_API_KEY
- ุจุฑุฑุณ ูุฌูุฏ purchase ุฏุฑ ุฏุชุงุจุณ
- ุจุฑุฑุณ ูุถุนุช active ุจูุฏู purchase

## ๐ง **ูุญูู ุงุณุชูุงุฏู ุงุฒ Debug Tool:**

### **1. ุงุฌุฑุง debug script:**
```bash
python debug_webhook.py
```

### **2. ุจุฑุฑุณ ูุงฺฏโูุง ุจูุจูุฏ ุงูุชู:**
ูุงฺฏโูุง ุฌุฏุฏ ุดุงูู ุงุทูุงุนุงุช ุฏููโุชุฑ ูุณุชูุฏ:
- ููุน purchase (profile ุง normal)
- ูุถุนุช server ู sub_id
- ุชุนุฏุงุฏ config ูุง ุงูุช ุดุฏู
- ุฎุทุงูุง ุฏูู ุจุง traceback

## ๐ **ฺฺฉโูุณุช ุนุจโุงุจ:**

### **ุจุฑุง ูุฑ purchase ฺฉู ุฎุทุง ูโุฏูุฏ:**
1. โ ุขุง purchase ุฏุฑ ุฏุชุงุจุณ ูุฌูุฏ ุฏุงุฑุฏุ
2. โ ุขุง sub_id ุฏุงุฑุฏุ
3. โ ุขุง server_id ุฏุงุฑุฏ (ุจุฑุง ุฎุฑุฏูุง ุนุงุฏ)ุ
4. โ ุขุง profile_id ุฏุงุฑุฏ (ุจุฑุง ุฎุฑุฏูุง ูพุฑููุงู)ุ
5. โ ุขุง ูุถุนุช active ุงุณุชุ
6. โ ุขุง server ูุฑุจูุทู ุฏุฑ ุฏุณุชุฑุณ ุงุณุชุ

### **ุจุฑุง webhook server:**
1. โ ุขุง ADMIN_API_KEY ุชูุธู ุดุฏูุ
2. โ ุขุง WEBHOOK_DOMAIN ุตุญุญ ุงุณุชุ
3. โ ุขุง webhook server ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุชุ
4. โ ุขุง ุฏุชุงุจุณ ุฏุฑ ุฏุณุชุฑุณ ุงุณุชุ

## ๐ **ูุฑุญูู ุจุนุฏ:**

ุจุนุฏ ุงุฒ ุงุฌุฑุง debug scriptุ ูุชุงุฌ ุฑุง ุจุฑุฑุณ ฺฉูุฏ ุชุง ูุดฺฉู ุฏูู ูุดุฎุต ุดูุฏ. ุงุญุชูุงูุงู ูุดฺฉู ุงุฒ ฺฉ ุงุฒ ููุงุฑุฏ ุฒุฑ ุงุณุช:

1. **Purchase ูุง ูุงูุต:** ุฎุฑุฏูุง ฺฉู sub_id ุง server_id ูุฏุงุฑูุฏ
2. **Server ูุง ุบุฑูุนุงู:** ุณุฑูุฑูุง ฺฉู ุฏุฑ ุฏุณุชุฑุณ ูุณุชูุฏ
3. **Profile ูุง ูุงูุต:** ูพุฑููุงูโูุง ฺฉู inbound ูุฏุงุฑูุฏ
4. **ูุดฺฉูุงุช ุดุจฺฉู:** ุนุฏู ุฏุณุชุฑุณ ุจู panel ูุง X-UI

## ๐ **ุฏุฑ ุตูุฑุช ูุงุฒ ุจู ฺฉูฺฉ ุจุดุชุฑ:**

ูุชุงุฌ debug script ุฑุง ุงุฑุณุงู ฺฉูุฏ ุชุง ูุดฺฉู ุฏูู ูุดุฎุต ุดูุฏ.
