# ๐ ุฑุงูููุง ุณุณุชู Subscription ุฌุฏุฏ

## ๐ **ุฎูุงุตู ุชุบุฑุงุช**

ุณุณุชู subscription ุฑุจุงุช AlamorVPN ุจูโุทูุฑ ฺฉุงูู ุจุงุฒุทุฑุงุญ ุดุฏู ุงุณุช ุชุง ูุดฺฉูุงุช ูุจู ุฑุง ุญู ฺฉูุฏ ู ูุงุจูุชโูุง ุฌุฏุฏ ุงุฑุงุฆู ุฏูุฏ.

## ๐ง **ูุดฺฉูุงุช ุญู ุดุฏู**

### โ **ูุดฺฉูุงุช ูุจู:**
1. **ุจุฑูุฒุฑุณุงู ูุดุฏู ููฺฉโูุง:** ููุช ุงุฏูู ูพูุฑุช ุง ุชูุธูุงุช ุงูุจุงูุฏ ุฑุง ุชุบุฑ ูโุฏุงุฏุ ฺฉุงุฑุจุฑุงู ุชุบุฑุงุช ุฑุง ููโุฏุฏูุฏ
2. **ุชฺฉ ุณุฑูุฑ:** ุฎุฑุฏูุง ูพุฑููุงู ููุท ุงุฒ ฺฉ ุณุฑูุฑ ุฏุชุง ุฏุฑุงูุช ูโฺฉุฑุฏูุฏ
3. **ุนุฏู ุงูุนุทุงู:** ุณุณุชู ูุงุจูุช ุชูุฒุน ุจุงุฑ ูุฏุงุดุช

### โ **ุฑุงูโุญูโูุง ุฌุฏุฏ:**
1. **ุฏุงูุงูฺฉ ฺฉุงูู:** ููฺฉโูุง ููุดู ุงุฒ ูพูู ุงุตู ุฏุชุง ุฏุฑุงูุช ูโฺฉููุฏ
2. **ฺูุฏ ุณุฑูุฑ:** ุฎุฑุฏูุง ูพุฑููุงู ุงุฒ ุชูุงู ุณุฑูุฑูุง ูุฑุชุจุท ุฏุชุง ุฌูุนโุขูุฑ ูโฺฉููุฏ
3. **ููุชุฑ ููุดููุฏ:** ููุท ฺฉุงููฺฏโูุง ูุฑุจูุท ุจู ุงูุจุงูุฏูุง ูพุฑููุงู ุจุฑฺฏุฑุฏุงูุฏู ูโุดููุฏ

## ๐๏ธ **ูุนูุงุฑ ุฌุฏุฏ**

### **ุจุฑุง ุฎุฑุฏ ูพุฑููุงู:**
```python
# ุณุณุชู ุฌุฏุฏ
def get_profile_subscription_data(purchase):
    # 1. ุฏุฑุงูุช ุชูุงู ุงูุจุงูุฏูุง ูพุฑููุงู ุงุฒ ุชูุงู ุณุฑูุฑูุง
    profile_inbounds = db_manager.get_inbounds_for_profile(profile_id, with_server_info=True)
    
    # 2. ฺฏุฑููโุจูุฏ ุจุฑ ุงุณุงุณ ุณุฑูุฑ
    inbounds_by_server = group_inbounds_by_server(profile_inbounds)
    
    # 3. ุฏุฑุงูุช ุฏุชุง ุงุฒ ูุฑ ุณุฑูุฑ
    all_configs = []
    for server_id, server_inbounds in inbounds_by_server.items():
        server_subscription_data = get_panel_subscription_data(server_info, sub_id)
        processed_configs = process_server_configs(server_subscription_data, server_inbounds)
        all_configs.extend(processed_configs)
    
    # 4. ุชุฑฺฉุจ ู ุจุฑฺฏุฑุฏุงูุฏู
    return "\n".join(all_configs)
```

### **ุจุฑุง ุฎุฑุฏ ุนุงุฏ:**
```python
# ุณุณุชู ุฌุฏุฏ
def get_normal_subscription_data(purchase):
    # ููุท ุงุฒ ุณุฑูุฑ ุงูุชุฎุงุจ ุดุฏู ุฏุชุง ุฏุฑุงูุช ูโฺฉูุฏ
    server = db_manager.get_server_by_id(purchase['server_id'])
    return get_panel_subscription_data(server, purchase['sub_id'])
```

## ๐ฏ **ูฺฺฏโูุง ฺฉูุฏ**

### **1. ุฌูุนโุขูุฑ ุฏุชุง ุงุฒ ฺูุฏู ุณุฑูุฑ**
- ุฎุฑุฏูุง ูพุฑููุงู ุงุฒ ุชูุงู ุณุฑูุฑูุง ูุฑุชุจุท ุฏุชุง ุฏุฑุงูุช ูโฺฉููุฏ
- ุงูฺฉุงู ุชูุฒุน ุจุงุฑ ุฑู ุณุฑูุฑูุง ูุฎุชูู
- ุงูุฒุงุด ูพุงุฏุงุฑ ู ุณุฑุนุช

### **2. ููุชุฑ ููุดููุฏ ฺฉุงููฺฏโูุง**
```python
def is_config_for_profile_inbounds(config, server_inbounds):
    # ุจุฑุฑุณ ุจุฑ ุงุณุงุณ remark
    config_remark = extract_config_remark(config)
    
    for inbound_info in server_inbounds:
        inbound_remark = inbound_info.get('remark', '')
        if inbound_remark and config_remark.lower() in inbound_remark.lower():
            return True
        
        # ุจุฑุฑุณ ุจุฑ ุงุณุงุณ inbound_id
        inbound_id = inbound_info.get('inbound_id')
        if inbound_id and str(inbound_id) in config:
            return True
    
    return False
```

### **3. ุงุณุชุฎุฑุงุฌ ุฎูุฏฺฉุงุฑ remark**
- **VMess:** ุงุณุชุฎุฑุงุฌ ุงุฒ ููุฏ `ps` ุฏุฑ JSON
- **VLESS/Trojan:** ุงุณุชุฎุฑุงุฌ ุงุฒ ุจุฎุด ุจุนุฏ ุงุฒ `#`
- **ูพุดุชุจุงู ุงุฒ ูุฑูุชโูุง ูุฎุชูู**

### **4. ุจุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ**
- ุชุบุฑุงุช ุงุฏูู ุจูุงูุงุตูู ุงุนูุงู ูโุดููุฏ
- ูุงุฒ ุจู restart ุฑุจุงุช ูุณุช
- ุณุณุชู cache ููุดููุฏ

## ๐ฎ **ูุญูู ุงุณุชูุงุฏู**

### **ุจุฑุง ุงุฏูู:**

#### **1. ุจุฑูุฒุฑุณุงู ููู ููฺฉโูุง:**
```
ููู ุงุฏูู โ ๐ ุจุฑูุฒุฑุณุงู ููู ููฺฉโูุง
```

#### **2. ูุดุงูุฏู ูุถุนุช ุณุณุชู:**
```
ููู ุงุฏูู โ ๐ ูุถุนุช ุณุณุชู Subscription
```

#### **3. ุจุฑุฑุณ ููฺฉโูุง:**
```
ููู ุงุฏูู โ ๐ง ุจุฑุฑุณ ููฺฉโูุง Subscription
```

### **ุจุฑุง ฺฉุงุฑุจุฑ:**

#### **1. ุจุฑูุฒุฑุณุงู ุชุฑุงูฺฉ:**
```
ุณุฑูุณโูุง ูู โ ุงูุชุฎุงุจ ุณุฑูุณ โ ๐ ุจุฑูุฒุฑุณุงู ุชุฑุงูฺฉ
```

#### **2. ุจุฑูุฒุฑุณุงู ููฺฉ ุณุงุจ:**
```
ุณุฑูุณโูุง ูู โ ุงูุชุฎุงุจ ุณุฑูุณ โ ๐ ุจุฑูุฒุฑุณุงู ููฺฉ
```

## ๐ **ููุงุด ูุชุงุฌ**

### **ุจุฑูุฒุฑุณุงู ููู ููฺฉโูุง:**
```
๐ ุจุฑูุฒุฑุณุงู ููฺฉโูุง Subscription

๐ ูุชุงุฌ ฺฉู:
โข โ ูููู: 15 ููฺฉ
โข โ ูุงูููู: 2 ููฺฉ
โข ๐ ฺฉู: 17 ููฺฉ

๐ ุฌุฒุฆุงุช ุฎุฑุฏูุง:
โข ๐ฏ ุฎุฑุฏูุง ูพุฑููุงู: 8
โข ๐ง ุฎุฑุฏูุง ุนุงุฏ: 9

๐ ุณุณุชู ุฌุฏุฏ ูุนุงู ุดุฏ!
โ ููฺฉโูุง ูพุฑููุงู ุงุฒ ุชูุงู ุณุฑูุฑูุง ูุฑุชุจุท ุจุฑูุฒุฑุณุงู ุดุฏูุฏ.
โ ููฺฉโูุง ุนุงุฏ ุงุฒ ุณุฑูุฑูุง ูุฑุจูุทู ุจุฑูุฒุฑุณุงู ุดุฏูุฏ.

๐ ูฺฺฏ ุฌุฏุฏ:
โข ุฎุฑุฏูุง ูพุฑููุงู ุญุงูุง ุงุฒ ุชูุงู ุณุฑูุฑูุง ูพุฑููุงู ุฏุชุง ุฌูุนโุขูุฑ ูโฺฉููุฏ
โข ุชุบุฑุงุช ุงุฏูู ุฏุฑ ูพูุฑุชโูุง ู ุชูุธูุงุช ุจูุงูุงุตูู ุงุนูุงู ูโุดููุฏ
โข ุณุณุชู ููุชุฑ ููุดููุฏ ฺฉุงููฺฏโูุง ูุนุงู ุงุณุช
```

### **ูุถุนุช ุณุณุชู:**
```
๐ ูุถุนุช ุณุณุชู Subscription

๐ ุชูุธูุงุช:
โข Webhook Domain: example.com
โข Admin API Key: ุชูุธู ุดุฏู

๐ ุขูุงุฑ ุฎุฑุฏูุง:
โข ฺฉู ุฎุฑุฏูุง ูุนุงู: 17
โข ุฎุฑุฏูุง ูพุฑููุงู: 8
โข ุฎุฑุฏูุง ุนุงุฏ: 9

๐ฏ ูพุฑููุงูโูุง:
โข ูพุฑููุงูโูุง ูุนุงู: 3
  - ูพุฑููุงู ุจุฑูุฒ: 5 ุงูุจุงูุฏ
  - ูพุฑููุงู ููุฑูโุง: 3 ุงูุจุงูุฏ
  - ูพุฑููุงู ุทูุง: 4 ุงูุจุงูุฏ

๐ ูฺฺฏโูุง ุฌุฏุฏ:
โ ุฌูุนโุขูุฑ ุฏุชุง ุงุฒ ุชูุงู ุณุฑูุฑูุง ูพุฑููุงู
โ ุจุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ ุชุบุฑุงุช ุงุฏูู
โ ููุชุฑ ููุดููุฏ ฺฉุงููฺฏโูุง
โ ุณุณุชู ุฏุงูุงูฺฉ subscription
```

## ๐ง **ุชูุธูุงุช ููุฑุฏ ูุงุฒ**

### **ูุชุบุฑูุง ูุญุท:**
```bash
# ุฏุฑ ูุงู .env
WEBHOOK_DOMAIN=your-domain.com
ADMIN_API_KEY=your-secret-api-key
```

### **ุณุงุฎุชุงุฑ ุฏุชุงุจุณ:**
```sql
-- ุฌุฏูู profile_inbounds ุจุฑุง ุงุฑุชุจุงุท ูพุฑููุงูโูุง ุจุง ุณุฑูุฑูุง
CREATE TABLE profile_inbounds (
    id SERIAL PRIMARY KEY,
    profile_id INTEGER REFERENCES profiles(id),
    server_id INTEGER REFERENCES servers(id),
    inbound_id INTEGER NOT NULL,
    config_params JSONB,
    raw_template TEXT,
    UNIQUE (profile_id, server_id, inbound_id)
);
```

## ๐จ **ูฺฉุงุช ููู**

### **1. ุณุงุฒฺฏุงุฑ:**
- ุณุณุชู ุฌุฏุฏ ุจุง ุฎุฑุฏูุง ูุฏู ุณุงุฒฺฏุงุฑ ุงุณุช
- ูฺ ุชุบุฑ ุฏุฑ ุนููฺฉุฑุฏ ุฎุฑุฏูุง ุนุงุฏ ุงุฌุงุฏ ูุดุฏู
- ุฎุฑุฏูุง ูพุฑููุงู ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ุงุฒ ุณุณุชู ุฌุฏุฏ ุงุณุชูุงุฏู ูโฺฉููุฏ

### **2. ุนููฺฉุฑุฏ:**
- ุจุฑูุฒุฑุณุงู ููฺฉู ุงุณุช ฺฉู ุฒูุงูโุจุฑ ุจุงุดุฏ (ุจุณุชู ุจู ุชุนุฏุงุฏ ุณุฑูุฑูุง)
- ุณุณุชู cache ุจุฑุง ุจูุจูุฏ ุณุฑุนุช ุงุณุชูุงุฏู ูโุดูุฏ
- ุฏุฑ ุตูุฑุช ุนุฏู ุฏุณุชุฑุณ ุจู ูพููุ ุงุฒ ุฏุชุง cache ุงุณุชูุงุฏู ูโุดูุฏ

### **3. ุงููุช:**
- ุชูุงู ุฏุฑุฎูุงุณุชโูุง ุจุง API Key ูุญุงูุธุช ูโุดููุฏ
- ูุงฺฏ ฺฉุงูู ุชูุงู ุนููุงุช
- ูุฏุฑุช ุฎุทุงูุง ูุฎุชูู

## ๐ **ูุชุฌูโฺฏุฑ**

ุณุณุชู ุฌุฏุฏ subscription ูุดฺฉูุงุช ุงุตู ุฑุง ุญู ฺฉุฑุฏู ู ูุงุจูุชโูุง ุฒุฑ ุฑุง ุงุฑุงุฆู ูโุฏูุฏ:

โ **ุฏุงูุงูฺฉ ฺฉุงูู:** ููฺฉโูุง ููุดู ุจูโุฑูุฒ ูุณุชูุฏ  
โ **ฺูุฏ ุณุฑูุฑ:** ูพุดุชุจุงู ุงุฒ ฺูุฏู ุณุฑูุฑ ุจุฑุง ูพุฑููุงูโูุง  
โ **ููุชุฑ ููุดููุฏ:** ููุท ฺฉุงููฺฏโูุง ูุฑุจูุทู ุจุฑฺฏุฑุฏุงูุฏู ูโุดููุฏ  
โ **ุจุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ:** ุชุบุฑุงุช ุงุฏูู ุจูุงูุงุตูู ุงุนูุงู ูโุดููุฏ  
โ **ุณุงุฒฺฏุงุฑ:** ุจุง ุณุณุชูโูุง ูุฏู ุณุงุฒฺฏุงุฑ ุงุณุช  

ุงู ุณุณุชู ุจุงุนุซ ุจูุจูุฏ ุชุฌุฑุจู ฺฉุงุฑุจุฑ ู ูุฏุฑุช ุขุณุงูโุชุฑ ุณุฑูุณโูุง ูโุดูุฏ.
