# ุฑุงูููุง ุฑุงูโุงูุฏุงุฒ Webhook Server

## ๐ง ูุดฺฉู ุฏฺฉูู "ุจุฑูุฒุฑุณุงู ููู ููฺฉโูุง"

ุงฺฏุฑ ุฏฺฉูู **"๐ ุจุฑูุฒุฑุณุงู ููู ููฺฉโูุง"** ฺฉุงุฑ ููโฺฉูุฏุ ุงุญุชูุงูุงู webhook server ุฏุฑ ุญุงู ุงุฌุฑุง ูุณุช.

## ๐ ุฑุงูโุงูุฏุงุฒ Webhook Server

### 1. ุจุฑุฑุณ ุชูุธูุงุช .env

ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู ุงู ูุชุบุฑูุง ุฏุฑ ูุงู `.env` ุชูุธู ุดุฏูโุงูุฏ:

```bash
# ุฏุงููู webhook
WEBHOOK_DOMAIN="paytest.alamornetwork.ir"

# ฺฉูุฏ API ุงุฏูู
ADMIN_API_KEY="your-secret-key"
```

### 2. ุงุฌุฑุง Webhook Server

```bash
# ุฏุฑ ุชุฑููุงู ุฌุฏุงฺฏุงูู
python webhook_server.py
```

ุง ุจุง systemd:

```bash
# ุฑุงูโุงูุฏุงุฒ ุณุฑูุณ
sudo systemctl start alamorwebhook

# ุจุฑุฑุณ ูุถุนุช
sudo systemctl status alamorwebhook

# ูุนุงูโุณุงุฒ ุฏุฑ ุจูุช
sudo systemctl enable alamorwebhook
```

### 3. ุจุฑุฑุณ ุนููฺฉุฑุฏ

```bash
# ุชุณุช endpoint
curl -X POST https://paytest.alamornetwork.ir/admin/update_configs/1 \
  -H "Authorization: Bearer your-secret-key"
```

## ๐ ุนุจโุงุจ

### ูุดฺฉู 1: "webhook server ุฏุฑ ุฏุณุชุฑุณ ูุณุช"

**ุฑุงู ุญู:**
1. ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู webhook server ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุช
2. ุจุฑุฑุณ ฺฉูุฏ ฺฉู ูพูุฑุช 8080 ุจุงุฒ ุงุณุช
3. ุจุฑุฑุณ ฺฉูุฏ ฺฉู ูุงุฑูุงู ุงุฌุงุฒู ุฏุณุชุฑุณ ูโุฏูุฏ

### ูุดฺฉู 2: "ุฎุทุง 401 Unauthorized"

**ุฑุงู ุญู:**
1. ุจุฑุฑุณ ฺฉูุฏ ฺฉู `ADMIN_API_KEY` ุฏุฑ `.env` ุชูุธู ุดุฏู ุงุณุช
2. ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู ฺฉูุฏ ุฏุฑ webhook server ู ุฑุจุงุช ฺฉุณุงู ุงุณุช

### ูุดฺฉู 3: "ุฎุทุง 404 Not Found"

**ุฑุงู ุญู:**
1. ุจุฑุฑุณ ฺฉูุฏ ฺฉู endpoint `/admin/update_configs/{purchase_id}` ุฏุฑ webhook server ููุฌูุฏ ุงุณุช
2. ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู purchase_id ูุนุชุจุฑ ุงุณุช

## ๐ ุนููฺฉุฑุฏ ุฏฺฉูู

ููุช ุฏฺฉูู **"๐ ุจุฑูุฒุฑุณุงู ููู ููฺฉโูุง"** ุฑุง ฺฉูฺฉ ฺฉูุฏ:

1. **ุจุฑุฑุณ ุชูุธูุงุช**: WEBHOOK_DOMAIN ู ADMIN_API_KEY
2. **ุฏุฑุงูุช ุฎุฑุฏูุง ูุนุงู**: ุงุฒ ุฏุชุงุจุณ
3. **ุงุฑุณุงู ุฏุฑุฎูุงุณุช**: ุจู webhook server ุจุฑุง ูุฑ ุฎุฑุฏ
4. **ููุงุด ุขูุงุฑ**: ุชุนุฏุงุฏ ููููุ ูุงูููู ู ุฎุทุงูุง ุงุชุตุงู
5. **ุฏฺฉูู ุจุงุฒฺฏุดุช**: ุจู ููู ุงุฏูู

## ๐ฏ ููููู ุฎุฑูุฌ ูููู

```
๐ ุจุฑูุฒุฑุณุงู ููฺฉโูุง Subscription

๐ ูุชุงุฌ:
โข โ ูููู: 12 ููฺฉ
โข โ ูุงูููู: 0 ููฺฉ
โข ๐ก ุฎุทุง ุงุชุตุงู: 0 ููฺฉ
โข ๐ ฺฉู: 12 ููฺฉ

๐ ุจุฑุฎ ููฺฉโูุง ุจุง ููููุช ุจุฑูุฒุฑุณุงู ุดุฏูุฏ.
```

## ๐ฏ ููููู ุฎุฑูุฌ ุฎุทุง

```
๐ ุจุฑูุฒุฑุณุงู ููฺฉโูุง Subscription

๐ ูุชุงุฌ:
โข โ ูููู: 0 ููฺฉ
โข โ ูุงูููู: 0 ููฺฉ
โข ๐ก ุฎุทุง ุงุชุตุงู: 12 ููฺฉ
โข ๐ ฺฉู: 12 ููฺฉ

โ๏ธ ูุดฺฉู: webhook server ุฏุฑ ุฏุณุชุฑุณ ูุณุช.
ูุทูุงู ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู webhook server ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุช.
```

## ๐ก ูฺฉุงุช ููู

1. **webhook server ุจุงุฏ ููุดู ุฏุฑ ุญุงู ุงุฌุฑุง ุจุงุดุฏ**
2. **ADMIN_API_KEY ุจุงุฏ ุงูู ู ููุญุตุฑ ุจู ูุฑุฏ ุจุงุดุฏ**
3. **WEBHOOK_DOMAIN ุจุงุฏ ูุงุจู ุฏุณุชุฑุณ ุจุงุดุฏ**
4. **ูพูุฑุช 8080 ุจุงุฏ ุจุงุฒ ุจุงุดุฏ**
5. **SSL certificate ุจุงุฏ ูุนุชุจุฑ ุจุงุดุฏ**

## ๐ง ุฏุณุชูุฑุงุช ููุฏ

```bash
# ุจุฑุฑุณ ูุถุนุช webhook server
ps aux | grep webhook_server

# ุจุฑุฑุณ ูพูุฑุช 8080
netstat -tlnp | grep 8080

# ุจุฑุฑุณ ูุงฺฏโูุง
tail -f /var/log/alamorwebhook.log

# ุชุณุช ุงุชุตุงู
curl -I https://paytest.alamornetwork.ir/admin/update_configs/1
```
